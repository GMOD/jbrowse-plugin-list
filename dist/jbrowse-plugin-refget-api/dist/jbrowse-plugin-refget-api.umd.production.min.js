var e,t;e=this,t=function(e,t,r,a,s,n,o){"use strict";var i={};function u(e){return"uniqueId"in e&&"object"!=typeof e.data}Object.defineProperty(i,"__esModule",{value:!0}),i.isFeature=function(e){return"object"==typeof e&&null!==e&&"function"==typeof e.get&&"function"==typeof e.id};class d{constructor(e){var t;u(e)?this.data=e:(this.data=e.data,this.parentHandle=e.parent);const r=u(e)?e.uniqueId:e.id;if(null==r)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(r),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error(`invalid feature data, end less than start. end: ${this.data.end} start: ${this.data.start}`);this.data.subfeatures&&(this.subfeatures=null===(t=this.data.subfeatures)||void 0===t?void 0:t.map(((e,t)=>"function"!=typeof e.get?new d({id:e.uniqueId||`${r}-${t}`,data:{strand:this.data.strand,...e},parent:this}):e)))}get(e){return"subfeatures"===e?this.subfeatures:"parent"===e?this.parent():this.data[e]}set(e,t){this.data[e]=t}tags(){return Object.keys(this.data)}id(){return this.uniqueId}parent(){return this.parentHandle}children(){return this.get("subfeatures")}toJSON(){const e={...this.data,uniqueId:this.id()},t=this.parent();t&&(e.parentId=t.id());const r=this.children();return r&&(e.subfeatures=r.map((e=>e.toJSON()))),e}static fromJSON(e){return new d({...e})}}var c=i.default=d;const p=a.ConfigurationSchema("RefGetAdapter",{serverLocation:{type:"fileLocation",description:"URL of the GA4GH refget API instance",defaultValue:{uri:"https://www.ebi.ac.uk/ena/cram/sequence",locationType:"UriLocation"}},sequenceIdType:{type:"string",defaultValue:"",model:o.types.enumeration("SequenceIdType",["","insdc"])},sequenceData:{type:"frozen",defaultValue:{},description:"List of sequence objects"}},{explicitlyTyped:!0});class f extends s.BaseSequenceAdapter{sequenceData;serverLocation;constructor(e,t,r){super(e,t,r),this.sequenceData=a.readConfObject(this.config,"sequenceData"),this.serverLocation=a.readConfObject(this.config,"serverLocation")}async getRefNames(){return Object.values(this.sequenceData).map((({name:e})=>e))}async getRegions(){const e=this.sequenceData;return Object.keys(e).map((t=>({refName:e[t].name,start:0,end:e[t].size})))}getFeatures({refName:e,start:t,end:r}){return n.ObservableCreate((async s=>{const{uri:n}=a.readConfObject(this.config,"serverLocation"),o=Object.keys(this.sequenceData).find((t=>this.sequenceData[t].name===e)),i=a.readConfObject(this.config,"sequenceIdType"),u=i?`${i}:${o}`:o;try{const a=await fetch(`${n}/${u}?start=${t}&end=${r}`);if(!a.ok)throw new Error(`Failed to fetch ${a.status} ${a.statusText}`);const o=await a.text();o&&s.next(new c({id:`${e} ${t}-${r}`,data:{refName:e,start:t,end:r,seq:o}})),s.complete()}catch(e){s.error(e)}}))}freeResources(){}}e.default=class extends r{name="RefGetPlugin";version="1.1.0";install(e){e.addAdapterType((()=>new t({name:"RefGetAdapter",configSchema:p,AdapterClass:f})))}},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@jbrowse/core/pluggableElementTypes/AdapterType"),require("@jbrowse/core/Plugin"),require("@jbrowse/core/configuration"),require("@jbrowse/core/data_adapters/BaseAdapter"),require("@jbrowse/core/util/rxjs"),require("mobx-state-tree")):"function"==typeof define&&define.amd?define(["exports","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/Plugin","@jbrowse/core/configuration","@jbrowse/core/data_adapters/BaseAdapter","@jbrowse/core/util/rxjs","mobx-state-tree"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).JBrowsePluginRefGet={},e.JBrowseExports["@jbrowse/core/pluggableElementTypes/AdapterType"],e.JBrowseExports["@jbrowse/core/Plugin"],e.JBrowseExports["@jbrowse/core/configuration"],e.JBrowseExports["@jbrowse/core/data_adapters/BaseAdapter"],e.JBrowseExports["@jbrowse/core/util/rxjs"],e.JBrowseExports["mobx-state-tree"]);
//# sourceMappingURL=jbrowse-plugin-refget-api.umd.production.min.js.map
