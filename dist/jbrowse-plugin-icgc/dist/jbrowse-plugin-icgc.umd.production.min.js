!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@jbrowse/core/Plugin"),require("@jbrowse/core/pluggableElementTypes/models"),require("@jbrowse/core/configuration"),require("@jbrowse/core/pluggableElementTypes/DisplayType"),require("@jbrowse/core/pluggableElementTypes/WidgetType"),require("@jbrowse/core/pluggableElementTypes/TrackType"),require("@jbrowse/core/pluggableElementTypes/AdapterType"),require("@jbrowse/core/util"),require("mobx-state-tree"),require("prop-types"),require("mobx-react"),require("@jbrowse/core/util/tracks"),require("react"),require("@material-ui/core/utils"),require("@jbrowse/core/util/types/mst"),require("@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail"),require("@material-ui/core"),require("@material-ui/lab"),require("@jbrowse/core/data_adapters/BaseAdapter"),require("@jbrowse/core/util/rxjs"),require("@material-ui/core/SvgIcon")):"function"==typeof define&&define.amd?define(["exports","@jbrowse/core/Plugin","@jbrowse/core/pluggableElementTypes/models","@jbrowse/core/configuration","@jbrowse/core/pluggableElementTypes/DisplayType","@jbrowse/core/pluggableElementTypes/WidgetType","@jbrowse/core/pluggableElementTypes/TrackType","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/util","mobx-state-tree","prop-types","mobx-react","@jbrowse/core/util/tracks","react","@material-ui/core/utils","@jbrowse/core/util/types/mst","@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail","@material-ui/core","@material-ui/lab","@jbrowse/core/data_adapters/BaseAdapter","@jbrowse/core/util/rxjs","@material-ui/core/SvgIcon"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).JBrowsePluginICGC={},e.JBrowseExports["@jbrowse/core/Plugin"],e.JBrowseExports["@jbrowse/core/pluggableElementTypes/models"],e.JBrowseExports["@jbrowse/core/configuration"],e.JBrowseExports["@jbrowse/core/pluggableElementTypes/DisplayType"],e.JBrowseExports["@jbrowse/core/pluggableElementTypes/WidgetType"],e.JBrowseExports["@jbrowse/core/pluggableElementTypes/TrackType"],e.JBrowseExports["@jbrowse/core/pluggableElementTypes/AdapterType"],e.JBrowseExports["@jbrowse/core/util"],e.JBrowseExports["mobx-state-tree"],e.JBrowseExports["prop-types"],e.JBrowseExports["mobx-react"],e.JBrowseExports["@jbrowse/core/util/tracks"],e.JBrowseExports.react,e.JBrowseExports["@material-ui/core/utils"],e.JBrowseExports["@jbrowse/core/util/types/mst"],e.JBrowseExports["@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail"],e.JBrowseExports["@material-ui/core"],e.JBrowseExports["@material-ui/lab"],e.JBrowseExports["@jbrowse/core/data_adapters/BaseAdapter"],e.JBrowseExports["@jbrowse/core/util/rxjs"],e.JBrowseExports["@material-ui/core/SvgIcon"])}(this,(function(e,t,r,n,a,o,i,u,l,c,s,f,p,d,y,h,v,m,b,g,w,x){"use strict";function _(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var E=_(t),O=_(a),C=_(o),S=_(i),T=_(u),k=_(c),j=_(s),P=_(f),I=_(d),A=_(y),F=_(x);function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){J(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function R(e,t,r,n,a,o,i){try{var u=e[o](i),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,a)}function B(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){R(o,n,a,i,u,"next",e)}function u(e){R(o,n,a,i,u,"throw",e)}i(void 0)}))}}function N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function G(e,t,r){return t&&D(e.prototype,t),r&&D(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function J(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function q(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&W(e,t)}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}function W(e,t){return W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},W(e,t)}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return z(e)}function H(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=V(e);if(t){var a=V(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return U(this,r)}}function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw a}}return o}}(e,t)||Y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(e){return function(e){if(Array.isArray(e))return Z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e,t){if(e){if("string"==typeof e)return Z(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Z(e,t):void 0}}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Q(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Y(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}var X="1.0.2",ee="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},te={},re={exports:{}};!function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports}(re);var ne={exports:{}},ae={exports:{}};!function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports}(ae);var oe={exports:{}};!function(e){e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw a}}return o}},e.exports.__esModule=!0,e.exports.default=e.exports}(oe);var ie={exports:{}},ue={exports:{}};!function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports}(ue),function(e){var t=ue.exports;e.exports=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports}(ie);var le={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports}(le),function(e){var t=ae.exports,r=oe.exports,n=ie.exports,a=le.exports;e.exports=function(e,o){return t(e)||r(e,o)||n(e,o)||a()},e.exports.__esModule=!0,e.exports.default=e.exports}(ne);var ce={exports:{}};!function(e){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports}(ce);var se={exports:{}};!function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(se);var fe={},pe={exports:{}},de={exports:{}};!function(e){e.exports=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t.indexOf(r=o[n])>=0||(a[r]=e[r]);return a},e.exports.__esModule=!0,e.exports.default=e.exports}(de),function(e){var t=de.exports;e.exports=function(e,r){if(null==e)return{};var n,a,o=t(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r.indexOf(n=i[a])>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o},e.exports.__esModule=!0,e.exports.default=e.exports}(pe);var ye,he,ve,me={exports:{}},be=1,ge=function(){return(be=(9301*be+49297)%233280)/233280},we=function(e){be=e},xe="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function _e(){ve=!1}function Ee(e){if(e){if(e!==ye){if(e.length!==xe.length)throw new Error("Custom alphabet for shortid must be "+xe.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,r){return t!==r.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+xe.length+" unique characters. These characters were not unique: "+t.join(", "));ye=e,_e()}}else ye!==xe&&(ye=xe,_e())}function Oe(){return ve||(ve=function(){ye||Ee(xe);for(var e,t=ye.split(""),r=[],n=ge();t.length>0;)n=ge(),e=Math.floor(n*t.length),r.push(t.splice(e,1)[0]);return r.join("")}())}var Ce,Se={get:function(){return ye||xe},characters:function(e){return Ee(e),ye},seed:function(e){we(e),he!==e&&(_e(),he=e)},lookup:function(e){return Oe()[e]},shuffled:Oe},Te="object"==typeof window&&(window.crypto||window.msCrypto);Ce=Te&&Te.getRandomValues?function(e){return Te.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],r=0;r<e;r++)t.push(Math.floor(256*Math.random()));return t};var ke,je,Pe=Se,Ie=Ce,Ae=function(e,t,r){for(var n=(2<<Math.log(t.length-1)/Math.LN2)-1,a=-~(1.6*n*r/t.length),o="";;)for(var i=e(a),u=a;u--;)if((o+=t[i[u]&n]||"").length===+r)return o},Fe=function(e){for(var t,r=0,n="";!t;)n+=Ae(Ie,Pe.get(),1),t=e<Math.pow(16,r+1),r++;return n},Le=function(e){var t="",r=Math.floor(.001*(Date.now()-1567752802062));return r===je?ke++:(ke=0,je=r),t+=Fe(7),t+=Fe(e),ke>0&&(t+=Fe(ke)),t+Fe(r)},Me=Se,Re=function(e){return!(!e||"string"!=typeof e||e.length<6||new RegExp("[^"+Me.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e))};!function(e){var t=Se,r=Le,n=Re,a=0;function o(){return r(a)}e.exports=o,e.exports.generate=o,e.exports.seed=function(r){return t.seed(r),e.exports},e.exports.worker=function(t){return a=t,e.exports},e.exports.characters=function(e){return void 0!==e&&t.characters(e),t.shuffled()},e.exports.isValid=n}(me);var Be=me.exports,Ne=re.exports;Object.defineProperty(fe,"__esModule",{value:!0}),fe.UriLocationRaw=fe.UriLocation=fe.Region=fe.PropTypes=fe.NoAssemblyRegion=fe.LocalPathLocation=fe.FileLocation=fe.ElementId=fe.BlobLocation=void 0;var De=Ne(ce.exports),Ge=Ne(pe.exports),Je=Ne(Be),qe=k.default,Ve=Ne(j.default),We=P.default,ze=["baseUri"],Ue=["locationType"];function He(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function $e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?He(Object(r),!0).forEach((function(t){(0,De.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):He(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ke=qe.types.optional(qe.types.identifier,Je.default.generate);fe.ElementId=Ke;var Ye={Region:Ve.default.shape({refName:Ve.default.string.isRequired,start:Ve.default.number.isRequired,end:Ve.default.number.isRequired}),ConfigSchema:We.PropTypes.objectOrObservableObject,Feature:Ve.default.shape({get:Ve.default.func.isRequired,id:Ve.default.func.isRequired})};fe.PropTypes=Ye;var Ze=qe.types.model("NoAssemblyRegion",{refName:qe.types.string,start:qe.types.number,end:qe.types.number,reversed:qe.types.optional(qe.types.boolean,!1)}).actions((function(e){return{setRefName:function(t){e.refName=t}}}));fe.NoAssemblyRegion=Ze;var Qe=qe.types.compose("Region",Ze,qe.types.model({assemblyName:qe.types.string}));fe.Region=Qe;var Xe=qe.types.model("LocalPathLocation",{locationType:qe.types.literal("LocalPathLocation"),localPath:qe.types.string});fe.LocalPathLocation=Xe;var et=qe.types.model("BlobLocation",{locationType:qe.types.literal("BlobLocation"),name:qe.types.string,blobId:qe.types.string});fe.BlobLocation=et;var tt=qe.types.model("UriLocation",{locationType:qe.types.literal("UriLocation"),uri:qe.types.string,baseUri:qe.types.maybe(qe.types.string),internetAccountId:qe.types.maybe(qe.types.string),internetAccountPreAuthorization:qe.types.maybe(qe.types.model("InternetAccountPreAuthorization",{internetAccountType:qe.types.string,authInfo:qe.types.frozen()}))});fe.UriLocationRaw=tt;var rt=qe.types.snapshotProcessor(tt,{postProcessor:function(e){var t=e.baseUri,r=(0,Ge.default)(e,ze);return t?e:r}});fe.UriLocation=rt;var nt=qe.types.snapshotProcessor(qe.types.union(Xe,rt,et),{preProcessor:function(e){if(e){var t=e.locationType,r=(0,Ge.default)(e,Ue);if(!t){var n="";return void 0!==r.uri?n="UriLocation":void 0!==r.localPath?n="LocalPathLocation":void 0!==r.blob&&(n="BlobLocation"),$e($e({},r),{},{locationType:n})}return e}}});fe.FileLocation=nt;var at={},ot={},it={},ut={exports:{}},lt=function(e){return e&&e.__esModule?e:{default:e}},ct=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function st(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ft=function(e,t,r){return t&&st(e.prototype,t),r&&st(e,r),e},pt={},dt=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},yt=dt,ht=dt,vt=lt((function(e){return function(e){if(Array.isArray(e))return yt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ht(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ht(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()})),mt={functions:"Jexl Function",transforms:"Transform"};pt.ArrayLiteral=function(e){return this.evalArray(e.value)},pt.BinaryExpression=function(e){var t=this,r=this._grammar.elements[e.operator];if(r.evalOnDemand){var n=function(e){return{eval:function(){return t.eval(e)}}};return r.evalOnDemand(n(e.left),n(e.right))}return this.Promise.all([this.eval(e.left),this.eval(e.right)]).then((function(e){return r.eval(e[0],e[1])}))},pt.ConditionalExpression=function(e){var t=this;return this.eval(e.test).then((function(r){return r?e.consequent?t.eval(e.consequent):r:t.eval(e.alternate)}))},pt.FilterExpression=function(e){var t=this;return this.eval(e.subject).then((function(r){return e.relative?t._filterRelative(r,e.expr):t._filterStatic(r,e.expr)}))},pt.Identifier=function(e){return e.from?this.eval(e.from).then((function(t){if(null!=t)return Array.isArray(t)&&(t=t[0]),t[e.value]})):e.relative?this._relContext[e.value]:this._context[e.value]},pt.Literal=function(e){return e.value},pt.ObjectLiteral=function(e){return this.evalMap(e.value)},pt.FunctionCall=function(e){var t=mt[e.pool];if(!t)throw new Error("Corrupt AST: Pool '".concat(e.pool,"' not found"));var r=this._grammar[e.pool][e.name];if(!r)throw new Error("".concat(t," ").concat(e.name," is not defined."));return this.evalArray(e.args||[]).then((function(e){return r.apply(void 0,(0,vt.default)(e))}))},pt.UnaryExpression=function(e){var t=this;return this.eval(e.right).then((function(r){return t._grammar.elements[e.operator].eval(r)}))};var bt=lt,gt=bt(ct),wt=bt(ft),xt=pt,_t=function(){function e(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Promise;(0,gt.default)(this,e),this._grammar=t,this._context=r||{},this._relContext=n||this._context,this.Promise=a}return(0,wt.default)(e,[{key:"eval",value:function(e){var t=this;return this.Promise.resolve().then((function(){return xt[e.type].call(t,e)}))}},{key:"evalArray",value:function(e){var t=this;return this.Promise.all(e.map((function(e){return t.eval(e)})))}},{key:"evalMap",value:function(e){var t=this,r=Object.keys(e),n={},a=r.map((function(r){return t.eval(e[r])}));return this.Promise.all(a).then((function(e){return e.forEach((function(e,t){n[r[t]]=e})),n}))}},{key:"_filterRelative",value:function(t,r){var n=this,a=[];return Array.isArray(t)||(t=void 0===t?[]:[t]),t.forEach((function(t){var o=new e(n._grammar,n._context,t,n.Promise);a.push(o.eval(r))})),this.Promise.all(a).then((function(e){var r=[];return e.forEach((function(e,n){e&&r.push(t[n])})),r}))}},{key:"_filterStatic",value:function(e,t){return this.eval(t).then((function(t){return"boolean"==typeof t?t?e:void 0:e[t]}))}}]),e}(),Et=_t,Ot=lt,Ct=Ot(ct),St=Ot(ft),Tt=/^-?(?:(?:[0-9]*\.[0-9]+)|[0-9]+)$/,kt=/^[a-zA-Zа-яА-Я_\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF$][a-zA-Zа-яА-Я0-9_\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF$]*$/,jt=/\\\\/,Pt=/^\s*$/,It=["'(?:(?:\\\\')|[^'])*'",'"(?:(?:\\\\")|[^"])*"',"\\s+","\\btrue\\b","\\bfalse\\b"],At=["[a-zA-Zа-яА-Я_À-ÖØ-öø-ÿ\\$][a-zA-Z0-9а-яА-Я_À-ÖØ-öø-ÿ\\$]*","(?:(?:[0-9]*\\.[0-9]+)|[0-9]+)"],Ft=["binaryOp","unaryOp","openParen","openBracket","question","colon"],Lt=function(){function e(t){(0,Ct.default)(this,e),this._grammar=t}return(0,St.default)(e,[{key:"getElements",value:function(e){var t=this._getSplitRegex();return e.split(t).filter((function(e){return e}))}},{key:"getTokens",value:function(e){for(var t=[],r=!1,n=0;n<e.length;n++)this._isWhitespace(e[n])?t.length&&(t[t.length-1].raw+=e[n]):"-"===e[n]&&this._isNegative(t)?r=!0:(r&&(e[n]="-"+e[n],r=!1),t.push(this._createToken(e[n])));return r&&t.push(this._createToken("-")),t}},{key:"tokenize",value:function(e){var t=this.getElements(e);return this.getTokens(t)}},{key:"_createToken",value:function(e){var t={type:"literal",value:e,raw:e};if('"'===e[0]||"'"===e[0])t.value=this._unquote(e);else if(e.match(Tt))t.value=parseFloat(e);else if("true"===e||"false"===e)t.value="true"===e;else if(this._grammar.elements[e])t.type=this._grammar.elements[e].type;else{if(!e.match(kt))throw new Error("Invalid expression token: ".concat(e));t.type="identifier"}return t}},{key:"_escapeRegExp",value:function(e){return(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).match(kt)&&(e="\\b"+e+"\\b"),e}},{key:"_getSplitRegex",value:function(){var e=this;if(!this._splitRegex){var t=Object.keys(this._grammar.elements).sort((function(e,t){return t.length-e.length})).map((function(t){return e._escapeRegExp(t)}),this);this._splitRegex=new RegExp("("+[It.join("|"),t.join("|"),At.join("|")].join("|")+")")}return this._splitRegex}},{key:"_isNegative",value:function(e){return!e.length||Ft.some((function(t){return t===e[e.length-1].type}))}},{key:"_isWhitespace",value:function(e){return!!e.match(Pt)}},{key:"_unquote",value:function(e){var t=e[0],r=new RegExp("\\\\"+t,"g");return e.substr(1,e.length-2).replace(r,t).replace(jt,"\\")}}]),e}(),Mt=Lt,Rt={argVal:function(e){e&&this._cursor.args.push(e)},arrayStart:function(){this._placeAtCursor({type:"ArrayLiteral",value:[]})},arrayVal:function(e){e&&this._cursor.value.push(e)},binaryOp:function(e){for(var t=this._grammar.elements[e.value].precedence||0,r=this._cursor._parent;r&&r.operator&&this._grammar.elements[r.operator].precedence>=t;)this._cursor=r,r=r._parent;var n={type:"BinaryExpression",operator:e.value,left:this._cursor};this._setParent(this._cursor,n),this._cursor=r,this._placeAtCursor(n)},dot:function(){this._nextIdentEncapsulate=this._cursor&&"UnaryExpression"!==this._cursor.type&&("BinaryExpression"!==this._cursor.type||"BinaryExpression"===this._cursor.type&&this._cursor.right),this._nextIdentRelative=!this._cursor||this._cursor&&!this._nextIdentEncapsulate,this._nextIdentRelative&&(this._relative=!0)},filter:function(e){this._placeBeforeCursor({type:"FilterExpression",expr:e,relative:this._subParser.isRelative(),subject:this._cursor})},functionCall:function(){this._placeBeforeCursor({type:"FunctionCall",name:this._cursor.value,args:[],pool:"functions"})},identifier:function(e){var t={type:"Identifier",value:e.value};this._nextIdentEncapsulate?(t.from=this._cursor,this._placeBeforeCursor(t),this._nextIdentEncapsulate=!1):(this._nextIdentRelative&&(t.relative=!0,this._nextIdentRelative=!1),this._placeAtCursor(t))},literal:function(e){this._placeAtCursor({type:"Literal",value:e.value})},objKey:function(e){this._curObjKey=e.value},objStart:function(){this._placeAtCursor({type:"ObjectLiteral",value:{}})},objVal:function(e){this._cursor.value[this._curObjKey]=e},subExpression:function(e){this._placeAtCursor(e)},ternaryEnd:function(e){this._cursor.alternate=e},ternaryMid:function(e){this._cursor.consequent=e},ternaryStart:function(){this._tree={type:"ConditionalExpression",test:this._tree},this._cursor=this._tree},transform:function(e){this._placeBeforeCursor({type:"FunctionCall",name:e.value,args:[this._cursor],pool:"transforms"})},unaryOp:function(e){this._placeAtCursor({type:"UnaryExpression",operator:e.value})}},Bt={};Bt.states={expectOperand:{tokenTypes:{literal:{toState:"expectBinOp"},identifier:{toState:"identifier"},unaryOp:{},openParen:{toState:"subExpression"},openCurl:{toState:"expectObjKey",handler:Rt.objStart},dot:{toState:"traverse"},openBracket:{toState:"arrayVal",handler:Rt.arrayStart}}},expectBinOp:{tokenTypes:{binaryOp:{toState:"expectOperand"},pipe:{toState:"expectTransform"},dot:{toState:"traverse"},question:{toState:"ternaryMid",handler:Rt.ternaryStart}},completable:!0},expectTransform:{tokenTypes:{identifier:{toState:"postTransform",handler:Rt.transform}}},expectObjKey:{tokenTypes:{identifier:{toState:"expectKeyValSep",handler:Rt.objKey},closeCurl:{toState:"expectBinOp"}}},expectKeyValSep:{tokenTypes:{colon:{toState:"objVal"}}},postTransform:{tokenTypes:{openParen:{toState:"argVal"},binaryOp:{toState:"expectOperand"},dot:{toState:"traverse"},openBracket:{toState:"filter"},pipe:{toState:"expectTransform"}},completable:!0},postArgs:{tokenTypes:{binaryOp:{toState:"expectOperand"},dot:{toState:"traverse"},openBracket:{toState:"filter"},pipe:{toState:"expectTransform"}},completable:!0},identifier:{tokenTypes:{binaryOp:{toState:"expectOperand"},dot:{toState:"traverse"},openBracket:{toState:"filter"},openParen:{toState:"argVal",handler:Rt.functionCall},pipe:{toState:"expectTransform"},question:{toState:"ternaryMid",handler:Rt.ternaryStart}},completable:!0},traverse:{tokenTypes:{identifier:{toState:"identifier"}}},filter:{subHandler:Rt.filter,endStates:{closeBracket:"identifier"}},subExpression:{subHandler:Rt.subExpression,endStates:{closeParen:"expectBinOp"}},argVal:{subHandler:Rt.argVal,endStates:{comma:"argVal",closeParen:"postArgs"}},objVal:{subHandler:Rt.objVal,endStates:{comma:"expectObjKey",closeCurl:"expectBinOp"}},arrayVal:{subHandler:Rt.arrayVal,endStates:{comma:"arrayVal",closeBracket:"expectBinOp"}},ternaryMid:{subHandler:Rt.ternaryMid,endStates:{colon:"ternaryEnd"}},ternaryEnd:{subHandler:Rt.ternaryEnd,completable:!0}};var Nt=lt,Dt=Nt(ct),Gt=Nt(ft),Jt=Rt,qt=Bt.states,Vt=function(){function e(t,r,n){(0,Dt.default)(this,e),this._grammar=t,this._state="expectOperand",this._tree=null,this._exprStr=r||"",this._relative=!1,this._stopMap=n||{}}return(0,Gt.default)(e,[{key:"addToken",value:function(e){if("complete"===this._state)throw new Error("Cannot add a new token to a completed Parser");var t=qt[this._state],r=this._exprStr;if(this._exprStr+=e.raw,t.subHandler){this._subParser||this._startSubExpression(r);var n=this._subParser.addToken(e);if(n){if(this._endSubExpression(),this._parentStop)return n;this._state=n}}else{if(!t.tokenTypes[e.type]){if(this._stopMap[e.type])return this._stopMap[e.type];throw new Error("Token ".concat(e.raw," (").concat(e.type,") unexpected in expression: ").concat(this._exprStr))}var a=t.tokenTypes[e.type],o=Jt[e.type];a.handler&&(o=a.handler),o&&o.call(this,e),a.toState&&(this._state=a.toState)}return!1}},{key:"addTokens",value:function(e){e.forEach(this.addToken,this)}},{key:"complete",value:function(){if(this._cursor&&!qt[this._state].completable)throw new Error("Unexpected end of expression: ".concat(this._exprStr));return this._subParser&&this._endSubExpression(),this._state="complete",this._cursor?this._tree:null}},{key:"isRelative",value:function(){return this._relative}},{key:"_endSubExpression",value:function(){qt[this._state].subHandler.call(this,this._subParser.complete()),this._subParser=null}},{key:"_placeAtCursor",value:function(e){this._cursor?(this._cursor.right=e,this._setParent(e,this._cursor)):this._tree=e,this._cursor=e}},{key:"_placeBeforeCursor",value:function(e){this._cursor=this._cursor._parent,this._placeAtCursor(e)}},{key:"_setParent",value:function(e,t){Object.defineProperty(e,"_parent",{value:t,writable:!0})}},{key:"_startSubExpression",value:function(t){var r=qt[this._state].endStates;r||(this._parentStop=!0,r=this._stopMap),this._subParser=new e(this._grammar,t,r)}}]),e}(),Wt=Vt,zt=lt,Ut=zt(ct),Ht=zt(ft),$t=function(){function e(t){(0,Ut.default)(this,e),t(this._resolve.bind(this),this._reject.bind(this))}return(0,Ht.default)(e,[{key:"catch",value:function(e){if(this.error)try{this._resolve(e(this.error))}catch(e){this._reject(e)}return this}},{key:"then",value:function(e,t){if(!this.error)try{this._resolve(e(this.value))}catch(e){this._reject(e)}return t&&this.catch(t),this}},{key:"_reject",value:function(e){this.value=void 0,this.error=e}},{key:"_resolve",value:function(t){t instanceof e?t.error?this._reject(t.error):this._resolve(t.value):(this.value=t,this.error=void 0)}}]),e}();$t.all=function(e){return new $t((function(t){t(e.map((function(e){for(;e instanceof $t;){if(e.error)throw Error(e.error);e=e.value}return e})))}))},$t.resolve=function(e){return new $t((function(t){return t(e)}))},$t.reject=function(e){return new $t((function(t,r){return r(e)}))};var Kt=$t,Yt=lt,Zt=Yt(ct),Qt=Yt(ft),Xt=Et,er=Mt,tr=Wt,rr=Kt,nr=function(){function e(t,r){(0,Zt.default)(this,e),this._grammar=t,this._exprStr=r,this._ast=null}return(0,Qt.default)(e,[{key:"compile",value:function(){var e=new er(this._grammar),t=new tr(this._grammar),r=e.tokenize(this._exprStr);return t.addTokens(r),this._ast=t.complete(),this}},{key:"eval",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._eval(e,Promise)}},{key:"evalSync",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._eval(e,rr);if(t.error)throw t.error;return t.value}},{key:"_eval",value:function(e,t){var r=this;return t.resolve().then((function(){var n=r._getAst();return new Xt(r._grammar,e,void 0,t).eval(n)}))}},{key:"_getAst",value:function(){return this._ast||this.compile(),this._ast}}]),e}(),ar=nr,or=lt,ir=or((function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e})),ur=or(ct),lr=or(ft),cr=ar,sr=function(){function e(){(0,ur.default)(this,e),this.expr=this.expr.bind(this),this._grammar={elements:{".":{type:"dot"},"[":{type:"openBracket"},"]":{type:"closeBracket"},"|":{type:"pipe"},"{":{type:"openCurl"},"}":{type:"closeCurl"},":":{type:"colon"},",":{type:"comma"},"(":{type:"openParen"},")":{type:"closeParen"},"?":{type:"question"},"+":{type:"binaryOp",precedence:30,eval:function(e,t){return e+t}},"-":{type:"binaryOp",precedence:30,eval:function(e,t){return e-t}},"*":{type:"binaryOp",precedence:40,eval:function(e,t){return e*t}},"/":{type:"binaryOp",precedence:40,eval:function(e,t){return e/t}},"//":{type:"binaryOp",precedence:40,eval:function(e,t){return Math.floor(e/t)}},"%":{type:"binaryOp",precedence:50,eval:function(e,t){return e%t}},"^":{type:"binaryOp",precedence:50,eval:function(e,t){return Math.pow(e,t)}},"==":{type:"binaryOp",precedence:20,eval:function(e,t){return e==t}},"!=":{type:"binaryOp",precedence:20,eval:function(e,t){return e!=t}},">":{type:"binaryOp",precedence:20,eval:function(e,t){return e>t}},">=":{type:"binaryOp",precedence:20,eval:function(e,t){return e>=t}},"<":{type:"binaryOp",precedence:20,eval:function(e,t){return e<t}},"<=":{type:"binaryOp",precedence:20,eval:function(e,t){return e<=t}},"&&":{type:"binaryOp",precedence:10,evalOnDemand:function(e,t){return e.eval().then((function(e){return e?t.eval():e}))}},"||":{type:"binaryOp",precedence:10,evalOnDemand:function(e,t){return e.eval().then((function(e){return e||t.eval()}))}},in:{type:"binaryOp",precedence:20,eval:function(e,t){return"string"==typeof t?-1!==t.indexOf(e):!!Array.isArray(t)&&t.some((function(t){return t===e}))}},"!":{type:"unaryOp",precedence:Infinity,eval:function(e){return!e}}},functions:{},transforms:{}}}return(0,lr.default)(e,[{key:"addBinaryOp",value:function(e,t,r,n){this._addGrammarElement(e,(0,ir.default)({type:"binaryOp",precedence:t},n?"evalOnDemand":"eval",r))}},{key:"addFunction",value:function(e,t){this._grammar.functions[e]=t}},{key:"addFunctions",value:function(e){for(var t in e)this._grammar.functions[t]=e[t]}},{key:"addUnaryOp",value:function(e,t){this._addGrammarElement(e,{type:"unaryOp",weight:Infinity,eval:t})}},{key:"addTransform",value:function(e,t){this._grammar.transforms[e]=t}},{key:"addTransforms",value:function(e){for(var t in e)this._grammar.transforms[t]=e[t]}},{key:"compile",value:function(e){return this.createExpression(e).compile()}},{key:"createExpression",value:function(e){return new cr(this._grammar,e)}},{key:"getFunction",value:function(e){return this._grammar.functions[e]}},{key:"getTransform",value:function(e){return this._grammar.transforms[e]}},{key:"eval",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.createExpression(e);return r.eval(t)}},{key:"evalSync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.createExpression(e);return r.evalSync(t)}},{key:"expr",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var a=e.reduce((function(e,t,n){return e+(t+(n<r.length?r[n]:""))}),"");return this.createExpression(a)}},{key:"removeOp",value:function(e){!this._grammar.elements[e]||"binaryOp"!==this._grammar.elements[e].type&&"unaryOp"!==this._grammar.elements[e].type||delete this._grammar.elements[e]}},{key:"_addGrammarElement",value:function(e,t){this._grammar.elements[e]=t}}]),e}();ut.exports=new sr,ut.exports.Jexl=sr;var fr=re.exports;Object.defineProperty(it,"__esModule",{value:!0}),it.default=function(){var e=new pr.default.Jexl;return e.addFunction("get",(function(e,t){return e.get(t)})),e.addFunction("parent",(function(e){return e.parent()})),e.addFunction("id",(function(e){return e.id()})),e.addFunction("cast",(function(e){return e})),e.addFunction("log",(function(e){return console.log(e),e})),e.addFunction("max",Math.max),e.addFunction("min",Math.min),e.addFunction("sqrt",Math.sqrt),e.addFunction("ceil",Math.ceil),e.addFunction("floor",Math.floor),e.addFunction("round",Math.round),e.addFunction("abs",Math.abs),e.addFunction("log10",Math.log10),e.addFunction("parseInt",Number.parseInt),e.addFunction("parseFloat",Number.parseFloat),e.addFunction("split",(function(e,t){return e.split(t)})),e.addFunction("charAt",(function(e,t){return e.charAt(t)})),e.addFunction("charCodeAt",(function(e,t){return e.charCodeAt(t)})),e.addFunction("codePointAt",(function(e,t){return e.codePointAt(t)})),e.addFunction("startsWith",(function(e,t,r){return e.startsWith(t,r)})),e.addFunction("endsWith",(function(e,t,r){return e.endsWith(t,r)})),e.addFunction("padEnd",(function(e,t,r){return e.padEnd(t,r)})),e.addFunction("padStart",(function(e,t,r){return e.padStart(t,r)})),e.addFunction("repeat",(function(e,t){return e.repeat(t)})),e.addFunction("replace",(function(e,t,r){return e.replace(t,r)})),e.addFunction("replaceAll",(function(e,t,r){return e.replaceAll(t,r)})),e.addFunction("slice",(function(e,t,r){return e.slice(t,r)})),e.addFunction("startsWith",(function(e,t,r){return e.startsWith(t,r)})),e.addFunction("substring",(function(e,t,r){return e.substring(t,r)})),e.addFunction("toLowerCase",(function(e){return e.toLowerCase()})),e.addFunction("toUpperCase",(function(e){return e.toUpperCase()})),e.addFunction("trim",(function(e){e.trim()})),e.addFunction("trimEnd",(function(e){return e.trimEnd()})),e.addFunction("trimStart",(function(e){return e.trimStart()})),e.addFunction("getTag",(function(e,t){var r=e.get("tags");return r?r[t]:e.get(t)})),e.addBinaryOp("&",15,(function(e,t){return e&t})),e};var pr=fr(ut.exports),dr=re.exports;Object.defineProperty(ot,"__esModule",{value:!0}),ot.stringToJexlExpression=function(e,t){var r="nosig|".concat(e);if(!hr[r]){if(!e.startsWith("jexl:"))throw new Error("string does not appear to be in jexl format");var n=e.split("jexl:")[1],a=t?t.compile("".concat(n)):(0,yr.default)().compile("".concat(n));hr[r]=a}return hr[r]};var yr=dr(it),hr={},vr=re.exports;Object.defineProperty(at,"__esModule",{value:!0}),at.default=function(e,t){var r=t.description,n=void 0===r?"":r,a=t.model,o=t.type,i=t.defaultValue,u=t.contextVariable,l=void 0===u?[]:u;if(!o)throw new Error("type name required");if(a||(a=xr[o]),!a)throw new Error('no builtin config slot type "'.concat(o,"\", and no 'model' param provided"));if(void 0===i)throw new Error("no 'defaultValue' provided");var c="".concat(e.charAt(0).toUpperCase()).concat(e.slice(1),"ConfigSlot"),s=br.types.model(c,{name:br.types.literal(e),description:br.types.literal(n),type:br.types.literal(o),value:br.types.optional(br.types.union(Sr,a),i)}).volatile((function(){return{contextVariable:l}})).views((function(e){return{get isCallback(){return String(e.value).startsWith("jexl:")}}})).views((function(e){return{get expr(){if(e.isCallback){var t=(0,br.getEnv)(e).pluginManager;return t||"undefined"!=typeof jest||console.warn("no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)"),(0,gr.stringToJexlExpression)(String(e.value),null==t?void 0:t.jexl)}return{evalSync:function(){return e.value}}},get valueJSON(){var t;if(!e.isCallback)return(t=e.value)&&t.toJSON?t.toJSON():'"'.concat(t,'"')}}})).preProcessSnapshot((function(t){return"object"===(0,mr.default)(t)&&t.name===e?t:{name:e,description:n,type:o,value:t}})).postProcessSnapshot((function(e){return"object"===(0,mr.default)(e.value)?JSON.stringify(e.value)!==JSON.stringify(i)?e.value:void 0:e.value!==i?e.value:void 0})).actions((function(e){return{set:function(t){e.value=t},reset:function(){e.value=i},convertToCallback:function(){e.isCallback||(e.value="jexl:".concat(e.valueJSON||"''"))},convertToValue:function(){if(e.isCallback){try{var t=e.expr.evalSync();if(void 0!==t)return void(e.value=t)}catch(e){}if(e.value=i,e.isCallback){if(!(o in _r))throw new Error("no fallbackDefault defined for type ".concat(o));e.value=_r[o]}}}}}));Cr[o]&&(s=s.extend(Cr[o]));var f=br.types.optional(s,{name:e,type:o,description:n,value:i});return Object.defineProperty(f,"isJBrowseConfigurationSlot",{value:!0}),f};var mr=vr(se.exports),br=k.default,gr=ot,wr=fe,xr={stringArray:br.types.array(br.types.string),stringArrayMap:br.types.map(br.types.array(br.types.string)),numberMap:br.types.map(br.types.number),boolean:br.types.boolean,color:br.types.refinement("Color",br.types.string,(function(){return!0})),integer:br.types.integer,number:br.types.number,string:br.types.string,text:br.types.string,fileLocation:wr.FileLocation,frozen:br.types.frozen()},_r={stringArray:[],stringArrayMap:{},numberMap:{},boolean:!0,color:"black",integer:1,number:1,string:"",text:"",fileLocation:{uri:"/path/to/resource.txt",locationType:"UriLocation"},frozen:{}},Er=function(e){return{views:{get valueJSON(){return e.value}}}},Or=function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}}}},Cr={fileLocation:Or,number:Er,integer:Er,boolean:Er,frozen:Or,stringArray:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t){e.value.push(t)},removeAtIndex:function(t){e.value.splice(t,1)},setAtIndex:function(t,r){e.value[t]=r}}}},stringArrayMap:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t,r){e.value.set(t,r)},remove:function(t){e.value.delete(t)},addToKey:function(t,r){var n=e.value.get(t);if(!n)throw new Error("".concat(t," not found"));n.push(r)},removeAtKeyIndex:function(t,r){var n=e.value.get(t);if(!n)throw new Error("".concat(t," not found"));n.splice(r,1)},setAtKeyIndex:function(t,r,n){var a=e.value.get(t);if(!a)throw new Error("".concat(t," not found"));a[r]=n}}}},numberMap:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t,r){e.value.set(t,r)},remove:function(t){e.value.delete(t)}}}}},Sr=br.types.refinement("JexlString",br.types.string,(function(e){return e.startsWith("jexl:")})),Tr={},kr={exports:{}},jr={exports:{}};!function(e){var t=ue.exports;e.exports=function(e){if(Array.isArray(e))return t(e)},e.exports.__esModule=!0,e.exports.default=e.exports}(jr);var Pr={exports:{}};!function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports}(Pr);var Ir={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports}(Ir),function(e){var t=jr.exports,r=Pr.exports,n=ie.exports,a=Ir.exports;e.exports=function(e){return t(e)||r(e)||n(e)||a()},e.exports.__esModule=!0,e.exports.default=e.exports}(kr);var Ar={};Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.getDefaultValue=function(e){if(!(0,Fr.isOptionalType)(e))throw new TypeError("type must be an optional type");return e._defaultValue||e.defaultValue},Ar.getEnumerationValues=function(e){return Mr(e).map((function(e){return e.value}))},Ar.getPropertyType=function(e,t){return e.properties[t]},Ar.getSubType=Lr,Ar.getUnionSubTypes=Mr,Ar.resolveLateType=function(e){return(0,Fr.isUnionType)(e)||(0,Fr.isArrayType)(e)||!(0,Fr.isLateType)(e)?e:e.getSubType()};var Fr=k.default;function Lr(e){var t;if((0,Fr.isOptionalType)(e))t=e._subtype||e.type;else{if(!(0,Fr.isArrayType)(e)&&!(0,Fr.isMapType)(e)){if("function"==typeof e.getSubType)return e.getSubType();throw new TypeError("unsupported mst type")}t=e._subtype||e._subType||e.subType}if(!t)throw new Error("failed to get subtype");return t}function Mr(e){if(!(0,Fr.isUnionType)(e))throw new TypeError("not an MST union type");var t=e._types||e.types||Lr(e)._types||Lr(e).types;if(!t)throw new Error("failed to extract subtypes from mst union");return t}var Rr=re.exports;Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.getConf=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new TypeError("must provide a model object");var n=e,a=n.configuration;if(Wr(a))return Jr(a,t,r);throw new TypeError("cannot getConf on this model, it has no configuration")},Tr.getTypeNamesFromExplicitlyTypedUnion=function e(t){if((0,Dr.isType)(t)&&(t=(0,Gr.resolveLateType)(t),(0,Dr.isUnionType)(t))){var r=[];return(0,Gr.getUnionSubTypes)(t).forEach((function(t){t=(0,Gr.resolveLateType)(t);var n=e(t);if(n.length||(n=[(0,Gr.getDefaultValue)(t).type]),!n[0])throw new Error("invalid config schema type ".concat(t));r.push.apply(r,(0,Nr.default)(n))})),r}return[]},Tr.isBareConfigurationSchemaType=qr,Tr.isConfigurationModel=Wr,Tr.isConfigurationSchemaType=Vr,Tr.isConfigurationSlotType=function(e){return"object"===(0,Br.default)(e)&&null!==e&&"isJBrowseConfigurationSlot"in e},Tr.readConfObject=Jr;var Br=Rr(se.exports),Nr=Rr(kr.exports),Dr=k.default,Gr=Ar;function Jr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new TypeError("must provide conf object to read");if(!t)return JSON.parse(JSON.stringify((0,Dr.getSnapshot)(e)));if("string"==typeof t){var n=e[t];if(!n&&(0,Dr.isStateTreeNode)(e)&&(0,Dr.isMapType)((0,Dr.getType)(e))&&(n=e.get(t)),!n)return;if(n.expr){var a=n.expr.evalSync(r);return(0,Dr.isStateTreeNode)(a)?JSON.parse(JSON.stringify((0,Dr.getSnapshot)(a))):a}return(0,Dr.isStateTreeNode)(n)?JSON.parse(JSON.stringify((0,Dr.getSnapshot)(n))):n}var o=t[0];if(t.length>1){var i=t.slice(1),u=e[o];if(!u&&(0,Dr.isStateTreeNode)(e)&&(0,Dr.isMapType)((0,Dr.getType)(e))&&(u=e.get(o)),!u)return;return Jr(u,i,r)}return Jr(e,o,r)}function qr(e){if((0,Dr.isType)(e)){if((0,Dr.isModelType)(e)&&("isJBrowseConfigurationSchema"in e||e.name.includes("ConfigurationSchema")))return!0;if((0,Dr.isLateType)(e))return!0}return!1}function Vr(e){return!!(0,Dr.isType)(e)&&(!!qr(e)||((0,Dr.isUnionType)(e)?(0,Gr.getUnionSubTypes)(e).every((function(e){return Vr(e)||"undefined"===e.name})):!(!(0,Dr.isOptionalType)(e)||!Vr((0,Gr.getSubType)(e)))||!(!(0,Dr.isArrayType)(e)||!Vr((0,Gr.getSubType)(e)))||!(!(0,Dr.isMapType)(e)||!Vr((0,Gr.getSubType)(e)))))}function Wr(e){return(0,Dr.isStateTreeNode)(e)&&Vr((0,Dr.getType)(e))}var zr=re.exports;Object.defineProperty(te,"__esModule",{value:!0});var Ur=te.ConfigurationReference=function(e){return Yr.types.union(Yr.types.reference(e),e)};te.ConfigurationSchema=function(e,t,r){var n=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof e)throw new Error("first arg must be string name of the model that this config schema goes with");var n=t,a=r;return r.baseConfiguration&&r.baseConfiguration.jbrowseSchemaDefinition&&(n=tn(tn({},r.baseConfiguration.jbrowseSchemaDefinition),n),delete(a=tn(tn({},r.baseConfiguration.jbrowseSchemaOptions||{}),r)).baseConfiguration),{schemaDefinition:n,options:a}}(e,t,r),a=n.schemaDefinition,o=n.options,i=function(e,t,r){var n,a={};if(r.explicitlyTyped&&(a.type=Yr.types.optional(Yr.types.literal(e),e)),r.explicitIdentifier&&r.implicitIdentifier)throw new Error("Cannot have both explicit and implicit identifiers in ".concat(e));r.explicitIdentifier?"string"==typeof r.explicitIdentifier?(a[r.explicitIdentifier]=Yr.types.identifier,n=r.explicitIdentifier):(a.id=Yr.types.identifier,n="id"):r.implicitIdentifier&&("string"==typeof r.implicitIdentifier?(a[r.implicitIdentifier]=Zr.ElementId,n=r.implicitIdentifier):(a.id=Zr.ElementId,n="id"));var o={isJBrowseConfigurationSchema:!0,jbrowseSchema:{modelName:e,definition:t,options:r}};Object.entries(t).forEach((function(t){var r=(0,Hr.default)(t,2),n=r[0],i=r[1];if((0,Yr.isType)(i)&&(0,Yr.isLateType)(i)||(0,Xr.isConfigurationSchemaType)(i))a[n]=i;else if("string"==typeof i||"number"==typeof i)o[n]=i;else{if("object"!==(0,Kr.default)(i))throw new Error('invalid configuration schema definition, "'.concat(n,'" must be either a valid configuration slot definition, a constant, or a nested configuration schema'));if(!i.type)throw new Error("no type set for config slot ".concat(e,".").concat(n));try{a[n]=(0,Qr.default)(n,i)}catch(t){throw new Error("invalid config slot definition for ".concat(e,".").concat(n,": ").concat(t))}}}));var i=Yr.types.model("".concat(e,"ConfigurationSchema"),a).actions((function(e){return{setSubschema:function(t,r){if(!(0,Xr.isConfigurationSchemaType)(a[t]))throw new Error("".concat(t," is not a subschema, cannot replace"));var n=(0,Yr.isStateTreeNode)(r)?r:a[t].create(r);return e[t]=n,n}}}));Object.keys(o).length&&(i=i.volatile((function(){return o}))),r.actions&&(i=i.actions(r.actions)),r.views&&(i=i.views(r.views)),r.extend&&(i=i.extend(r.extend));var u=n?(0,$r.default)({},n,"placeholderId"):{},l=r.explicitlyTyped?tn({type:e},u):u,c=(0,Yr.getSnapshot)(i.create(l));return i=i.postProcessSnapshot((function(e){for(var t={},r=!0,n=0,a=Object.entries(e);n<a.length;n++){var i=(0,Hr.default)(a[n],2),u=i[0],l=i[1];r&&("object"===(0,Kr.default)(c[u])&&"object"===(0,Kr.default)(l)?JSON.stringify(c[u])!==JSON.stringify(l)&&(r=!1):c[u]!==l&&(r=!1)),void 0===l||void 0!==o[u]||"object"===(0,Kr.default)(s=l)&&!Array.isArray(s)&&null!==s&&0===Object.keys(s).length||rn(l)||(t[u]=l)}var s;return r?{}:t})),r.preProcessSnapshot&&(i=i.preProcessSnapshot(r.preProcessSnapshot)),Yr.types.optional(i,l)}(e,a,o);return i.isJBrowseConfigurationSchema=!0,i.jbrowseSchemaDefinition=a,i.jbrowseSchemaOptions=o,i};var Hr=zr(ne.exports),$r=zr(ce.exports),Kr=zr(se.exports),Yr=k.default,Zr=fe,Qr=zr(at),Xr=Tr;function en(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function tn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?en(Object(r),!0).forEach((function(t){(0,$r.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):en(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function rn(e){return Array.isArray(e)&&0===e.length}var nn={};function an(e){return on=an="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},an(e)}var on=an,un=on;function ln(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return ln=function(){return e},e}var cn=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==un(e)&&"function"!=typeof e)return{default:e};var t=ln();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,t&&t.set(e,r),r},sn={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=A.default}(sn);var fn=lt,pn=cn;Object.defineProperty(nn,"__esModule",{value:!0});var dn=nn.default=void 0,yn=pn(I.default),hn=(0,fn(sn).default)(yn.createElement("path",{d:"M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"}),"FilterList");function vn(e,t){var r=t.getPlugin("LinearGenomeViewPlugin");return c.types.compose("LinearICGCDisplay",r.exports.BaseLinearDisplay,c.types.model({type:c.types.literal("LinearICGCDisplay"),configuration:Ur(e)})).actions((function(e){return{openFilterConfig:function(){var t=l.getSession(e),r=t.addWidget("ICGCFilterWidget","icgcFilter",{target:e.parentTrack.configuration});t.showWidget(r)},selectFeature:function(t){if(t){var r=l.getSession(e),n=r.addWidget("ICGCFeatureWidget","icgcFeature",{featureData:t.toJSON()});r.showWidget(n),r.setSelection(t)}}}})).views((function(e){var t=e.renderProps,r=e.trackMenuItems;return{renderProps:function(){return M(M(M({},t()),p.getParentRenderProps(e)),{},{displayModel:e,config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type},trackMenuItems:function(){return[].concat(K(r()),[{label:"Filter",onClick:e.openFilterConfig,icon:dn}])}}}))}dn=nn.default=hn;var mn=n.ConfigurationSchema("GDCFeatureWidget",{});function bn(e){return c.types.model("ICGCFeatureWidget",{id:h.ElementId,type:c.types.literal("ICGCFeatureWidget"),featureData:c.types.frozen({}),view:c.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData={}}}}))}var gn=m.makeStyles((function(){return{table:{padding:0},link:{color:"rgb(0, 0, 238)"},innerCard:{width:"100%",maxHeight:600,overflow:"auto"}}})),wn=/(?:(?:((http|ftp|https):){0,1}\/\/)|www\.)([\w_-]+(?:(?:\.[\w_-]+)+))(?:([\w.,@?^=%&:\/~+#-]*[\w@?^=%&\/~+#-]){0,1})/g,xn=f.observer((function(e){var t=e.id,r=e.functionalImpact,n=e.consequenceType;return I.default.createElement(I.default.Fragment,null,I.default.createElement(m.TableRow,null,t?I.default.createElement(m.TableCell,null,t):null,I.default.createElement(m.TableCell,null,r),I.default.createElement(m.TableCell,null,n)))}));function _n(e){var t=e.transcripts,r=e.id,n=e.geneId,a=gn();return I.default.createElement("div",{className:a.innerCard},I.default.createElement(m.Table,{className:a.table},I.default.createElement(m.TableBody,null,I.default.createElement(m.TableRow,{key:"header-row-comp-".concat(r||n)},r?I.default.createElement(m.TableCell,null,"id"):null,I.default.createElement(m.TableCell,null,"functionalImpact"),I.default.createElement(m.TableCell,null,"consequenceType")),t?t.map((function(e,t){return I.default.createElement(xn,{id:e.id?e.id:null,key:t,functionalImpact:e.functionalImpact,consequenceType:e.consequence?e.consequence.type:e.consequenceType})})):null)))}function En(e){var t=e.observations,r=function(e){var t=[];return e.forEach((function(e){for(var r in e)"string"==typeof e[r]&&(e[r].includes("http")||e[r].includes("www."))&&t.push(r)})),t}(t),n=["SNV and INDEL calling - www.compbio.group.cam.ac.uk/research/icgc/snv-and-indel-calling"];return I.default.createElement(v.BaseCard,{title:"Observations"},t&&r?t.map((function(e,a){return I.default.createElement("div",{key:a},I.default.createElement(v.Attributes,{attributes:e,omit:r}),r.map((function(t,r){return I.default.createElement("div",{key:r},e[t]?I.default.createElement(m.Grid,{container:!0,alignItems:"center"},I.default.createElement(v.FieldName,{name:"".concat(t),width:l.measureText("".concat(t),12)+10}),e[t].includes("http")||e[t].includes("www")&&!n.find((function(r){return r===e[t]}))?I.default.createElement(m.Link,{href:e[t].match(wn)},e[t].split(wn)[0]):I.default.createElement("span",null,e[t].split(wn)[0])):null)})),t.length>1?I.default.createElement("hr",null):null)})):null)}function On(e){var t=e.genes;return I.default.createElement(v.BaseCard,{title:"Genes"},t?t.map((function(e,r){return I.default.createElement("div",{key:r},I.default.createElement(v.Attributes,{attributes:e,omit:["consequence"]}),I.default.createElement(_n,{transcripts:e.consequence,geneId:e.geneId}),t.length>1?I.default.createElement("hr",null):null)})):null)}function Cn(e){var t=gn(),r=e.id,n="https://dcc.icgc.org/mutations/".concat(r);return I.default.createElement(v.BaseCard,{title:"External Links"},I.default.createElement("div",{className:t.innerCard},I.default.createElement(m.Table,{className:t.table},I.default.createElement(m.TableBody,null,I.default.createElement(m.TableRow,{key:"link-".concat(r)},I.default.createElement(m.TableCell,null,"ICGC Data Portal"),I.default.createElement(m.TableCell,null,I.default.createElement(m.Link,{className:t.link,target:"_blank",rel:"noopener",href:"".concat(n),underline:"always"},r)))))))}function Sn(e){var t=e.model.featureData,r=t.functionalImpact?t.functionalImpact.includes("High")?"High":t.functionalImpact.includes("Low")?"Low":"Unknown":void 0,n=M(M({},t),{},{functionalImpact:r});return I.default.createElement(m.Paper,{"data-testid":"icgc-widget"},I.default.createElement(v.FeatureDetails,M(M({feature:r?n:t},e),{},{omit:["transcripts","genes","observations"]})),t.transcripts&&I.default.createElement(v.BaseCard,{title:"Transcripts"},I.default.createElement(_n,{transcripts:t.transcripts,id:t.id})),t.observations&&I.default.createElement(En,{observations:t.observations}),t.genes&&I.default.createElement(On,{genes:t.genes}),I.default.createElement(Cn,{id:t.mutationId?t.mutationId:t.id}))}var Tn,kn=f.observer(Sn),jn=function(e){var t=c.types.model({id:c.types.identifier,category:c.types.string,type:c.types.string,filter:c.types.string}).actions((function(e){return{setCategory:function(t){e.category=t,e.filter=""},setFilter:function(t){e.filter=t},getFilter:function(){return e.filter}}})),r=c.types.model({id:c.types.identifier,value:c.types.string});return c.types.model("ICGCFilterWidget",{id:h.ElementId,type:c.types.literal("ICGCFilterWidget"),target:c.types.safeReference(e.pluggableConfigSchemaType("track")),filters:c.types.array(t),colourBy:c.types.map(r)}).actions((function(e){return{setTarget:function(t){e.target=t},addFilter:function(r,n,a,o){e.filters.push(t.create({id:r,category:n,type:a,filter:o}))},deleteFilter:function(t){var r=e.filters.findIndex((function(e){return e.id===t}));e.filters.remove(e.filters[r])},getFiltersByType:function(t){return e.filters.filter((function(e){return e.type===t}))},clearFilters:function(){e.filters=e.filters.filter((function(e){return 0===e.filter.length}))}}}))},Pn=new Uint8Array(16);function In(){if(!Tn&&!(Tn="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Tn(Pn)}var An=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Fn(e){return"string"==typeof e&&An.test(e)}for(var Ln=[],Mn=0;Mn<256;++Mn)Ln.push((Mn+256).toString(16).substr(1));function Rn(e,t,r){var n=(e=e||{}).random||(e.rng||In)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var a=0;a<16;++a)t[r+a]=n[a];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(Ln[e[t+0]]+Ln[e[t+1]]+Ln[e[t+2]]+Ln[e[t+3]]+"-"+Ln[e[t+4]]+Ln[e[t+5]]+"-"+Ln[e[t+6]]+Ln[e[t+7]]+"-"+Ln[e[t+8]]+Ln[e[t+9]]+"-"+Ln[e[t+10]]+Ln[e[t+11]]+Ln[e[t+12]]+Ln[e[t+13]]+Ln[e[t+14]]+Ln[e[t+15]]).toLowerCase();if(!Fn(r))throw TypeError("Stringified UUID is invalid");return r}(n)}var Bn={exports:{}};!function(e){var t=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var a=Object.create((t&&t.prototype instanceof v?t:v).prototype),o=new k(n||[]);return a._invoke=function(e,t,r){var n=f;return function(a,o){if(n===d)throw new Error("Generator is already running");if(n===y){if("throw"===a)throw o;return P()}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var u=C(i,r);if(u){if(u===h)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var l=s(e,t,r);if("normal"===l.type){if(n=r.done?y:p,l.arg===h)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n=y,r.method="throw",r.arg=l.arg)}}}(e,r,o),a}function s(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var f="suspendedStart",p="suspendedYield",d="executing",y="completed",h={};function v(){}function m(){}function b(){}var g={};g[o]=function(){return this};var w=Object.getPrototypeOf,x=w&&w(w(j([])));x&&x!==r&&n.call(x,o)&&(g=x);var _=b.prototype=v.prototype=Object.create(g);function E(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(a,o,i,u){var l=s(e[a],e,o);if("throw"!==l.type){var c=l.arg,f=c.value;return f&&"object"==typeof f&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,i,u)}),(function(e){r("throw",e,i,u)})):t.resolve(f).then((function(e){c.value=e,i(c)}),(function(e){return r("throw",e,i,u)}))}u(l.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){r(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function C(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method))return h;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var a=s(n,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var o=a.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function j(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function r(){for(;++a<e.length;)if(n.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}return{next:P}}function P(){return{value:t,done:!0}}return m.prototype=_.constructor=b,b.constructor=m,m.displayName=l(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(O.prototype),O.prototype[i]=function(){return this},e.AsyncIterator=O,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new O(c(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(_),l(_,u,"Generator"),_[o]=function(){return this},_.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=j,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return u.type="throw",u.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],u=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;T(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:j(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),h}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}(Bn);var Nn=Bn.exports,Dn={},Gn=lt,Jn=cn;Object.defineProperty(Dn,"__esModule",{value:!0});var qn=Dn.default=void 0,Vn=Jn(I.default),Wn=(0,Gn(sn).default)(Vn.createElement("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");qn=Dn.default=Wn;var zn={},Un=lt,Hn=cn;Object.defineProperty(zn,"__esModule",{value:!0});var $n=zn.default=void 0,Kn=Hn(I.default),Yn=(0,Un(sn).default)(Kn.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");function Zn(e){return Qn.apply(this,arguments)}function Qn(){return(Qn=B(Nn.mark((function e(t){var r;return Nn.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://localhost:7080/proxy/api/v1/".concat(t,"?facetsOnly=true&include=facets"),{method:"GET",headers:{"content-type":"application/json"}});case 2:if((r=e.sent).ok){e.next=5;break}throw new Error("Failed to fetch ".concat(r.status," ").concat(r.statusText));case 5:return e.abrupt("return",r.json());case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}$n=zn.default=Yn;var Xn=f.observer((function(e){var t=e.facets,r=e.schema,n=e.filterModel,a=$(d.useState(n.category?n.category:t?Object.keys(t)[0]:""),2),o=a[0],i=a[1],u=$(d.useState(n.filter?n.filter.replace(/(["]+)/g,"").replace(/([\[])+/g,"").replace(/[\]]+/g,"").split(","):[]),2),l=u[0],c=u[1];function s(e,t){var r={};return e.forEach((function(e){var t=J({},e.category,{is:JSON.parse(e.filter)});r[e.type.slice(0,-1)]=M(M({},r[e.type.slice(0,-1)]),t)})),t.adapter.filters.set(JSON.stringify(r))}return I.default.createElement(I.default.Fragment,null,I.default.createElement(m.List,null,I.default.createElement(m.ListItem,{style:{gap:"4px"}},I.default.createElement(m.FormControl,{fullWidth:!0},I.default.createElement(m.InputLabel,null,"Category"),I.default.createElement(m.Select,{label:"Category",value:o,onChange:function(e){i(e.target.value),c([]),n.setCategory(e.target.value)},inputProps:{"data-testid":"category_select"}},t?Object.keys(t).map((function(e,t){return I.default.createElement(m.MenuItem,{value:e,key:"".concat(e,"-").concat(t,"-menuitem"),"data-testid":"cat_menuitem_".concat(t)},e.replace(/([A-Z])/g," $1").replace(/^./,(function(e){return e.toUpperCase()})))})):null)),I.default.createElement(m.FormControl,{fullWidth:!0},I.default.createElement(m.InputLabel,null,"Filters"),I.default.createElement(m.Select,{label:"Filters",value:l,onChange:function(e){c(e.target.value),n.setFilter(JSON.stringify(e.target.value)),s(r.filters,r.target)},input:I.default.createElement(m.Input,null),renderValue:function(e){return e.join(", ")},multiple:!0,inputProps:{"data-testid":"filters_select"}},t&&o&&t[o].terms?t[o].terms.sort((function(e,t){return e.term<t.term?-1:e.term>t.term?1:0})).map((function(e,t){return I.default.createElement(m.MenuItem,{value:e.term,key:"".concat(e.term,"-").concat(t,"-menuitem"),"data-testid":"fil_menuitem_".concat(t)},I.default.createElement(m.Checkbox,{checked:!!l&&l.indexOf(e.term)>-1}),I.default.createElement(m.ListItemText,{primary:e.term}))})):null)),I.default.createElement(m.Tooltip,{title:"Remove filter","aria-label":"remove filter"},I.default.createElement(m.IconButton,{"aria-label":"remove filter",onClick:function(){r.deleteFilter(n.id),s(r.filters,r.target)},"data-testid":"remove_filter_icon_button"},I.default.createElement($n,null))))))})),ea=f.observer((function(e){var t=e.schema,r=e.facetType,n=$(d.useState(),2),a=n[0],o=n[1];return d.useEffect((function(){var e=function(){var e=B(Nn.mark((function e(){return Nn.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zn(r);case 2:o(e.sent.facets);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[r]),I.default.createElement(I.default.Fragment,null,t.filters.map((function(e){return e.type===r?I.default.createElement(Xn,{facets:a,schema:t,filterModel:e,key:e.id}):null})),I.default.createElement(m.Button,{variant:"outlined",onClick:function(){t.addFilter(Rn(),a?Object.keys(a)[0]:"",r,"")},startIcon:I.default.createElement(qn,null)},"Add Filter"))})),ta={},ra=lt,na=cn;Object.defineProperty(ta,"__esModule",{value:!0});var aa=ta.default=void 0,oa=na(I.default),ia=(0,ra(sn).default)(oa.createElement("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"}),"Undo");aa=ta.default=ia;var ua=["children","value","index"],la=m.makeStyles((function(e){return{root:{display:"flex",flexDirection:"column",margin:e.spacing(1),gap:e.spacing(2)},tabRoot:{width:"33%",minWidth:"100px"},paper:{padding:e.spacing(2)}}}));function ca(e){var t=e.children,r=e.value,n=e.index,a=function(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t.indexOf(r=o[n])>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t.indexOf(r=o[n])>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(e,ua);return I.default.createElement("div",M({role:"tabpanel",hidden:r!==n,id:"simple-tabpanel-".concat(n),"aria-labelledby":"simple-tab-".concat(n)},a),r===n&&I.default.createElement(m.Box,{style:{padding:3}},t))}function sa(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}function fa(e){var t=e.model,r=la(),n=$(d.useState(0),2),a=n[0],o=n[1],i=$(d.useState(t.target.adapter.featureType.value?t.target.adapter.featureType.value:"mutations"),2),u=i[0],l=i[1];return d.useEffect((function(){t.clearFilters();var e=JSON.parse(t.target.adapter.filters.value);for(var r in e)for(var n in e[r])t.addFilter(Rn(),n,"".concat(r,"s"),JSON.stringify(e[r][n].is))}),[t]),I.default.createElement("div",{className:r.root},I.default.createElement(m.Paper,{className:r.paper},I.default.createElement(m.Typography,{variant:"h6"},"Track Type"),I.default.createElement(m.FormControl,null,I.default.createElement(m.Select,{value:u,onChange:function(e){l(e.target.value),t.target.adapter.featureType.set(e.target.value)},inputProps:{"data-testid":"icgc_track_type_select"}},I.default.createElement(m.MenuItem,{value:"mutations","data-testid":"option_mutations"},"Mutations"),I.default.createElement(m.MenuItem,{value:"occurrences","data-testid":"option_occurrences"},"Mutation Occurrences")),I.default.createElement(m.FormHelperText,null,"Select what to retrieve from the ICGC with your selected filters."))),I.default.createElement(m.Paper,{className:r.paper},I.default.createElement(m.Grid,{container:!0,style:{gap:"4px"}},I.default.createElement(m.Typography,{variant:"h6"},"Filters"),I.default.createElement(m.Tooltip,{title:"Clear all filters","aria-label":"clear all filters",onClick:function(){t.clearFilters(),t.target.adapter.filters.set("{}")}},I.default.createElement(m.IconButton,{color:"primary","data-testid":"clear_all_filters_icon_button"},I.default.createElement(aa,null)))),I.default.createElement(m.Box,null,I.default.createElement(m.Tabs,{value:a,onChange:function(e,t){o(t)},"aria-label":"filtering tabs"},I.default.createElement(m.Tab,M({classes:{root:r.tabRoot},label:"Donors"},sa(0))),I.default.createElement(m.Tab,M({classes:{root:r.tabRoot},label:"Genes"},sa(1))),I.default.createElement(m.Tab,M({classes:{root:r.tabRoot},label:"Mutations"},sa(2))))),I.default.createElement(ca,{value:a,index:0},I.default.createElement(ea,{schema:t,type:u,facetType:"donors"})),I.default.createElement(ca,{value:a,index:1},I.default.createElement(ea,{schema:t,type:u,facetType:"genes"})),I.default.createElement(ca,{value:a,index:2},I.default.createElement(ea,{schema:t,type:u,facetType:"mutations"}))),"mutations"===u?I.default.createElement(m.Paper,{className:r.paper},I.default.createElement(m.Typography,{variant:"h6"},"Colour Legend"),I.default.createElement(m.Table,null,I.default.createElement(m.TableHead,null,I.default.createElement(m.TableRow,null,I.default.createElement(m.TableCell,null,"functionalImpact"),I.default.createElement(m.TableCell,null,"Corresponding colour"))),I.default.createElement(m.TableBody,null,I.default.createElement(m.TableRow,null,I.default.createElement(m.TableCell,null,"High"),I.default.createElement(m.TableCell,null,I.default.createElement(m.Chip,{label:"Red",style:{backgroundColor:"red",color:"white"}}))),I.default.createElement(m.TableRow,null,I.default.createElement(m.TableCell,null,"Low"),I.default.createElement(m.TableCell,null,I.default.createElement(m.Chip,{label:"Blue",style:{backgroundColor:"blue",color:"white"}}))),I.default.createElement(m.TableRow,null,I.default.createElement(m.TableCell,null,"Unknown/Undefined"),I.default.createElement(m.TableCell,null,I.default.createElement(m.Chip,{label:"Goldenrod",style:{backgroundColor:"goldenrod",color:"white"}})))))):null)}var pa=f.observer(fa);function da(e){return c.types.model("ICGCSearchWidget",{id:h.ElementId,type:c.types.literal("ICGCSearchWidget")}).volatile((function(){return{trackData:void 0,indexTrackData:void 0}})).actions((function(e){return{setTrackData:function(t){e.trackData=t},setIndexTrackData:function(t){e.indexTrackData=t},clearData:function(){e.indexTrackData=void 0,e.trackData=void 0}}}))}var ya=m.makeStyles((function(e){return{root:{margin:e.spacing(1)},paper:{display:"flex",flexDirection:"column",gap:e.spacing(2),padding:e.spacing(2),margin:"0px 0px ".concat(e.spacing(1),"px 0px"),justifyContent:"center"},submitContainer:{display:"flex",flexDirection:"column"},buttonContainer:{display:"flex",justifyContent:"flex-end"}}}));function ha(e){var t=e.model,r=ya(),n=$(d.useState(!1),2),a=n[0],o=n[1],i=l.getSession(t);return I.default.createElement("div",{className:r.root},I.default.createElement(m.Paper,{className:r.paper},I.default.createElement(m.Typography,{variant:"h6",component:"h1",align:"center"},"Quick-add an ICGC Browse Track"),I.default.createElement(m.Typography,{variant:"body1",align:"center"},"Add additional Browse tracks to your current view by clicking this button."),a?I.default.createElement(b.Alert,{severity:"success"},"The requested Browse track has been added."):null,I.default.createElement(m.Button,{color:"primary",variant:"contained",size:"large",startIcon:I.default.createElement(qn,null),onClick:function(){if(i){var e=Date.now(),t="icgc_browse_track-".concat(e);i.addTrackConf({type:"ICGCTrack",trackId:t,name:"ICGC Browse ".concat(e),assemblyNames:["hg38"],category:["Annotation"],adapter:{ICGCAdapterId:"DefaultICGCAdapter",type:"ICGCAdapter"},displays:[{type:"LinearICGCDisplay",displayId:"icgc_browse_track_linear_".concat(e)}]}),0===i.views.length&&i.addView("LinearGenomeView",{}),i.views[0].showTrack(t),o(!0)}}},"Add New ICGC Browse Track")))}var va=f.observer(ha),ma=function(){function e(t){N(this,e),J(this,"icgcObject",void 0),J(this,"data",void 0),J(this,"uniqueId",void 0),J(this,"featureType",void 0),this.icgcObject=t.icgcObject,this.featureType=t.featureType?t.featureType:"mutation",this.data=this.dataFromICGCObject(this.icgcObject,this.featureType),this.uniqueId=t.id}return G(e,[{key:"get",value:function(e){return this.icgcObject[e]||this.data[e]}},{key:"set",value:function(){}},{key:"parent",value:function(){}},{key:"children",value:function(){}},{key:"tags",value:function(){return[].concat(K(Object.keys(this.data)),K(Object.keys(this.icgcObject)))}},{key:"id",value:function(){return this.uniqueId}},{key:"dataFromICGCObject",value:function(e,t){var r={refName:e.chromosome,type:e.mutationType,start:e.start-1,end:e.end};return"occurrences"===t&&(r.type=e.mutationId,r.id=e.donorId,r.note=e.mutationId),r}},{key:"toJSON",value:function(){return M(M({uniqueId:this.uniqueId},this.data),this.icgcObject)}}]),e}(),ba={},ga={},wa={},xa={};function _a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ea(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Oa(e,t,r){return t&&Ea(e.prototype,t),r&&Ea(e,r),e}function Ca(e){return Ca=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ca(e)}function Sa(e,t){return Sa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Sa(e,t)}function Ta(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ka(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?Ta(e):t}function ja(e,t,r){return ja="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ca(e)););return e}(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(r):a.value}},ja(e,t,r||e)}Object.defineProperty(xa,"__esModule",{value:!0});var Pa=function(){function e(){_a(this,e),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return Oa(e,[{key:"addEventListener",value:function(e,t,r){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:r})}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var r=this.listeners[e],n=0,a=r.length;n<a;n++)if(r[n].callback===t)return void r.splice(n,1)}},{key:"dispatchEvent",value:function(e){if(e.type in this.listeners){for(var t=this.listeners[e.type].slice(),r=0,n=t.length;r<n;r++){var a=t[r];try{a.callback.call(this,e)}catch(e){Promise.resolve().then((function(){throw e}))}a.options&&a.options.once&&this.removeEventListener(e.type,a.callback)}return!e.defaultPrevented}}}]),e}(),Ia=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Sa(e,t)}(a,e);var t,r,n=(t=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Ca(t);if(r){var a=Ca(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return ka(this,e)});function a(){var e;return _a(this,a),(e=n.call(this)).listeners||Pa.call(Ta(e)),Object.defineProperty(Ta(e),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(Ta(e),"onabort",{value:null,writable:!0,configurable:!0}),e}return Oa(a,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),ja(Ca(a.prototype),"dispatchEvent",this).call(this,e)}}]),a}(Pa),Aa=function(){function e(){_a(this,e),Object.defineProperty(this,"signal",{value:new Ia,writable:!0,configurable:!0})}return Oa(e,[{key:"abort",value:function(){var e;try{e=new Event("abort")}catch(t){"undefined"!=typeof document?document.createEvent?(e=document.createEvent("Event")).initEvent("abort",!1,!1):(e=document.createEventObject()).type="abort":e={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(e)}},{key:"toString",value:function(){return"[object AbortController]"}}]),e}();"undefined"!=typeof Symbol&&Symbol.toStringTag&&(Aa.prototype[Symbol.toStringTag]="AbortController",Ia.prototype[Symbol.toStringTag]="AbortSignal"),xa.AbortController=Aa,xa.AbortSignal=Ia,xa.abortableFetch=function(e){"function"==typeof e&&(e={fetch:e});var t=e.fetch,r=e.Request,n=void 0===r?t.Request:r,a=e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL,o=void 0!==a&&a;if(!function(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}({fetch:t,Request:n,AbortController:e.AbortController,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:o}))return{fetch:t,Request:i};var i=n;(i&&!i.prototype.hasOwnProperty("signal")||o)&&((i=function(e,t){var r;t&&t.signal&&(r=t.signal,delete t.signal);var a=new n(e,t);return r&&Object.defineProperty(a,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),a}).prototype=n.prototype);var u=t;return{fetch:function(e,t){var r=i&&i.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(r){var n;try{n=new DOMException("Aborted","AbortError")}catch(e){(n=new Error("Aborted")).name="AbortError"}if(r.aborted)return Promise.reject(n);var a=new Promise((function(e,t){r.addEventListener("abort",(function(){return t(n)}),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([a,u(e,t)])}return u(e,t)},Request:i}},Object.defineProperty(wa,"__esModule",{value:!0}),wa.AbortSignal=wa.AbortController=void 0;const Fa=xa;var La=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==ee)return ee;throw new Error("unable to locate global object")};let Ma=void 0===La().AbortController?Fa.AbortController:La().AbortController;wa.AbortController=Ma;let Ra=void 0===La().AbortController?Fa.AbortSignal:La().AbortSignal;wa.AbortSignal=Ra;var Ba={};Object.defineProperty(Ba,"__esModule",{value:!0});const Na=wa;class Da{}Ba.default=class{constructor(){this.signals=new Set,this.abortController=new Na.AbortController}addSignal(e=new Da){if(this.signal.aborted)throw new Error("cannot add a signal, already aborted!");this.signals.add(e),e.aborted?this.handleAborted(e):"function"==typeof e.addEventListener&&e.addEventListener("abort",(()=>{this.handleAborted(e)}))}handleAborted(e){this.signals.delete(e),0===this.signals.size&&this.abortController.abort()}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}};var Ga={};Object.defineProperty(Ga,"__esModule",{value:!0}),Ga.default=class{constructor(){this.callbacks=new Set}addCallback(e=(()=>{})){this.callbacks.add(e),e(this.currentMessage)}callback(e){this.currentMessage=e,this.callbacks.forEach((t=>{t(e)}))}};var Ja=ee&&ee.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ga,"__esModule",{value:!0});const qa=wa,Va=Ja(Ba),Wa=Ja(Ga);class za{constructor({fill:e,cache:t}){if("function"!=typeof e)throw new TypeError("must pass a fill function");if("object"!=typeof t)throw new TypeError("must pass a cache object");if("function"!=typeof t.get||"function"!=typeof t.set||"function"!=typeof t.delete)throw new TypeError("cache must implement get(key), set(key, val), and and delete(key)");this.cache=t,this.fillCallback=e}static isAbortException(e){return"AbortError"===e.name||"ERR_ABORTED"===e.code||"AbortError: aborted"===e.message||"Error: aborted"===e.message}evict(e,t){this.cache.get(e)===t&&this.cache.delete(e)}fill(e,t,r,n){const a=new Va.default,o=new Wa.default;o.addCallback(n);const i={aborter:a,promise:this.fillCallback(t,a.signal,(e=>{o.callback(e)})),settled:!1,statusReporter:o,get aborted(){return this.aborter.signal.aborted}};i.aborter.addSignal(r),i.aborter.signal.addEventListener("abort",(()=>{i.settled||this.evict(e,i)})),i.promise.then((()=>{i.settled=!0}),(()=>{i.settled=!0,this.evict(e,i)})).catch((e=>{throw console.error(e),e})),this.cache.set(e,i)}static checkSinglePromise(e,t){function r(){if(t&&t.aborted)throw Object.assign(new Error("aborted"),{code:"ERR_ABORTED"})}return e.then((e=>(r(),e)),(e=>{throw r(),e}))}has(e){return this.cache.has(e)}get(e,t,r,n){if(!r&&t instanceof qa.AbortSignal)throw new TypeError("second get argument appears to be an AbortSignal, perhaps you meant to pass `null` for the fill data?");const a=this.cache.get(e);return a?a.aborted&&!a.settled?(this.evict(e,a),this.get(e,t,r,n)):a.settled?a.promise:(a.aborter.addSignal(r),a.statusReporter.addCallback(n),za.checkSinglePromise(a.promise,r)):(this.fill(e,t,r,n),za.checkSinglePromise(this.cache.get(e).promise,r))}delete(e){const t=this.cache.get(e);t&&(t.settled||t.aborter.abort(),this.cache.delete(e))}clear(){const e=this.cache.keys();let t=0;for(let r=e.next();!r.done;r=e.next())this.delete(r.value),t+=1;return t}}ga.default=za;var Ua=ee&&ee.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ba,"__esModule",{value:!0});const Ha=Ua(ga);var $a=ba.default=Ha.default,Ka={},Ya=Bn.exports,Za={exports:{}};!function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports}(Za);var Qa={exports:{}};!function(e){function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports}(Qa);var Xa=re.exports;Object.defineProperty(Ka,"__esModule",{value:!0});var eo=Ka.default=void 0,to=Xa(Ya),ro=Xa(ne.exports),no=Xa(Za.exports),ao=Xa(Qa.exports);function oo(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return io(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?io(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}function io(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var uo=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,no.default)(this,t),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=e.maxSize,this.cache=new Map,this.oldCache=new Map,this._size=0}return(0,ao.default)(t,[{key:"_set",value:function(e,t){this.cache.set(e,t),this._size+=1,this._size>=this.maxSize&&(this._size=0,this.oldCache=this.cache,this.cache=new Map)}},{key:"get",value:function(e){if(this.cache.has(e))return this.cache.get(e);if(this.oldCache.has(e)){var t=this.oldCache.get(e);return this.oldCache.delete(e),this._set(e,t),t}}},{key:"set",value:function(e,t){return this.cache.has(e)?this.cache.set(e,t):this._set(e,t),this}},{key:"has",value:function(e){return this.cache.has(e)||this.oldCache.has(e)}},{key:"peek",value:function(e){return this.cache.has(e)?this.cache.get(e):this.oldCache.has(e)?this.oldCache.get(e):void 0}},{key:"delete",value:function(e){var t=this.cache.delete(e);return t&&(this._size-=1),this.oldCache.delete(e)||t}},{key:"clear",value:function(){this.cache.clear(),this.oldCache.clear(),this._size=0}},{key:"keys",value:to.default.mark((function e(){var t,r,n,a;return to.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=oo(this),e.prev=1,t.s();case 3:if((r=t.n()).done){e.next=9;break}return n=(0,ro.default)(r.value,1),a=n[0],e.next=7,a;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"values",value:to.default.mark((function e(){var t,r,n,a;return to.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=oo(this),e.prev=1,t.s();case 3:if((r=t.n()).done){e.next=9;break}return n=(0,ro.default)(r.value,2),a=n[1],e.next=7,a;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:e,value:to.default.mark((function e(){var t,r,n,a,o,i,u;return to.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=oo(this.cache),e.prev=1,t.s();case 3:if((r=t.n()).done){e.next=9;break}return n=r.value,e.next=7,n;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:a=oo(this.oldCache),e.prev=18,a.s();case 20:if((o=a.n()).done){e.next=28;break}if(u=(0,ro.default)(i=o.value,1),this.cache.has(u[0])){e.next=26;break}return e.next=26,i;case 26:e.next=20;break;case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(18),a.e(e.t1);case 33:return e.prev=33,a.f(),e.finish(33);case 36:case"end":return e.stop()}}),e,this,[[1,11,14,17],[18,30,33,36]])}))},{key:"size",get:function(){var e,t=0,r=oo(this.oldCache.keys());try{for(r.s();!(e=r.n()).done;)this.cache.has(e.value)||(t+=1)}catch(e){r.e(e)}finally{r.f()}return this._size+t}}]),t}(Symbol.iterator);eo=Ka.default=uo;var lo=function(e){q(a,e);var t,r=H(a);function a(e){var t,o;N(this,a),J(z(t=r.call(this,e)),"filters",void 0),J(z(t),"size",void 0),J(z(t),"featureType",void 0),J(z(t),"featureCache",new $a({cache:new eo({maxSize:200}),fill:(o=B(Nn.mark((function e(r,n){return Nn.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.fetchFeatures(r,n));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})}));var i=n.readConfObject(e,"filters"),u=n.readConfObject(e,"size"),l=n.readConfObject(e,"featureType");return t.filters=i,t.size=u,t.featureType=l,t}return G(a,[{key:"fetchFeatures",value:function(){var e=B(Nn.mark((function e(t,r){var n;return Nn.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://localhost:7080/proxy/api/v1/".concat(this.featureType,"?filters=").concat(t,"&size=").concat(this.size),{method:"GET",headers:{"content-type":"application/json"},signal:r});case 2:if((n=e.sent).ok){e.next=5;break}throw new Error("Failed to fetch ".concat(n.status," ").concat(n.statusText));case 5:return e.abrupt("return",n.json());case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getRefNames",value:(t=B(Nn.mark((function e(){return Nn.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",["chr1","chr10","chr11","chr12","chr13","chr14","chr15","chr16","chr17","chr18","chr19","chr2","chr20","chr21","chr22","chr3","chr4","chr5","chr6","chr7","chr8","chr9","chrX","chrY"]);case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"createQuery",value:function(e,t,r){var n={};if("{}"!=this.filters){var a=JSON.parse(this.filters).mutation,o=JSON.parse(this.filters).gene,i=JSON.parse(this.filters).donor;n=a?{mutation:M(M({},a),{},{location:{is:"".concat(e,":").concat(t,"-").concat(r)}})}:{mutation:{location:{is:"".concat(e,":").concat(t,"-").concat(r)}}},o&&(n=M(M({},n),{},{gene:o})),i&&(n=M(M({},n),{},{donor:i}))}else n={mutation:{location:{is:"".concat(e,":").concat(t,"-").concat(r)}}};return n}},{key:"getFeatures",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.refName,a=e.start,o=e.end;return w.ObservableCreate(function(){var e=B(Nn.mark((function e(i){var u,l,c,s,f,p;return Nn.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u=t.createQuery(n,a,o),l="mutations"===t.featureType?"id":"donorId",e.next=5,t.featureCache.get(JSON.stringify(u),JSON.stringify(u),r.signal);case 5:c=Q(e.sent.hits);try{for(c.s();!(s=c.n()).done;)p=new ma({icgcObject:f=s.value,id:f[l],featureType:t.featureType}),i.next(p)}catch(e){c.e(e)}finally{c.f()}e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),i.error(e.t0);case 13:i.complete();case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),r.signal)}},{key:"freeResources",value:function(){}}]),a}(g.BaseFeatureDataAdapter);J(lo,"capabilities",["getFeatures","getRefNames"]);var co=n.ConfigurationSchema("ICGCAdapter",{filters:{type:"string",defaultValue:"{}",description:"The filters to be applied to the track. Only edit if you know what you are doing."},colourBy:{type:"string",defaultValue:"{}",description:"Colour features based on track attributes. Only edit if you know what you are doing."},featureType:{type:"stringEnum",model:c.types.enumeration("Feature Type",["mutations","occurrences"]),defaultValue:"mutations",description:"The type of track to add"},size:{type:"integer",defaultValue:5e3,description:"The max number of features to show."}},{explicitlyTyped:!0,explicitIdentifier:"ICGCAdapterId"});function so(e){return I.default.createElement(F.default,M({},e),I.default.createElement("path",{d:"M12,2C6.48,2,2,6.48,2,12c0,1.33,0.26,2.61,0.74,3.77L8,10.5l3.3,2.78L14.58,10H13V8h5v5h-2v-1.58L11.41,16l-3.29-2.79 l-4.4,4.4C5.52,20.26,8.56,22,12,22h8c1.1,0,2-0.9,2-2v-8C22,6.48,17.52,2,12,2z M19.5,20.5c-0.55,0-1-0.45-1-1s0.45-1,1-1 s1,0.45,1,1S20.05,20.5,19.5,20.5z"}))}var fo=function(e){q(a,e);var t=H(a);function a(){var e;N(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return J(z(e=t.call.apply(t,[this].concat(n))),"name","ICGC"),J(z(e),"version",X),e}return G(a,[{key:"install",value:function(e){var t=e.getPlugin("LinearGenomeViewPlugin").exports.BaseLinearDisplayComponent;e.addTrackType((function(){var t=n.ConfigurationSchema("ICGCTrack",{},{baseConfiguration:r.createBaseTrackConfig(e),explicitIdentifier:"trackId"});return new S.default({name:"ICGCTrack",configSchema:t,stateModel:r.createBaseTrackModel(e,"ICGCTrack",t)})})),e.addDisplayType((function(){var r=function(e){var t=e.getPlugin("LinearGenomeViewPlugin").exports.baseLinearDisplayConfigSchema;return n.ConfigurationSchema("LinearICGCDisplay",{renderer:c.types.optional(e.pluggableConfigSchemaType("renderer"),{color1:"jexl:fi(feature)"})},{baseConfiguration:t,explicitlyTyped:!0})}(e);return new O.default({name:"LinearICGCDisplay",configSchema:r,stateModel:vn(r,e),trackType:"ICGCTrack",viewType:"LinearGenomeView",ReactComponent:t})})),e.addAdapterType((function(){return new T.default({name:"ICGCAdapter",configSchema:co,adapterMetadata:{hiddenFromGUI:!0},AdapterClass:lo})})),e.addWidgetType((function(){return new C.default({name:"ICGCFeatureWidget",heading:"Feature Details",configSchema:mn,stateModel:bn(e),ReactComponent:kn})})),e.addWidgetType((function(){return new C.default(M({name:"ICGCFilterWidget"},function(e){return{configSchema:n.ConfigurationSchema("ICGCFilterWidget",{}),ReactComponent:pa,stateModel:e.load(jn),HeadingComponent:function(){return I.default.createElement(I.default.Fragment,null,"ICGC Filters")}}}(e)))})),e.addWidgetType((function(){return new C.default(M({name:"ICGCSearchWidget",heading:"Search ICGC"},(t=e,{configSchema:n.ConfigurationSchema("ICGCSearchWidget",{}),ReactComponent:va,stateModel:t.load(da),HeadingComponent:function(){return I.default.createElement(I.default.Fragment,null,"ICGC Data Import")}})));var t})),e.jexl.addFunction("fi",(function(e){return e.get("functionalImpact")?e.get("functionalImpact").includes("High")?"red":e.get("functionalImpact").includes("Low")?"blue":"goldenrod":"goldenrod"}))}},{key:"configure",value:function(e){l.isAbstractMenuManager(e.rootModel)&&e.rootModel.appendToMenu("Tools",{label:"ICGC Data Import",icon:so,onClick:function(e){e.showWidget(e.addWidget("ICGCSearchWidget","icgcSearchWidget"))}})}}]),a}(E.default);e.default=fo,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=jbrowse-plugin-icgc.umd.production.min.js.map
